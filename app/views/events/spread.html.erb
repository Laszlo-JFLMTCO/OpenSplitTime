<% content_for :title do %>
    <% "OpenSplitTime: Full results - #{@spread_display.name}" %>
<% end %>
<div class="row header">
  <div class="col-xs-5">
    <%= render 'event_info', view_object: @spread_display, title: 'Full results' %>
  </div>
  <div class="col-xs-7 page-navigation">
    <div class="row">
      <%= link_to_beacon_button(@spread_display) %>
      <%= link_to_enter_live_entry(@spread_display, @current_user) %>
      <%= link_to_download_spread_csv(@spread_display, @current_user) %>
      <%= render 'view_buttons', view_object: @spread_display %>
    </div>
  </div>
</div>

<div class="row header">
  <div class="col-xs-5 page-navigation-left">
    <% if @spread_display.ordered_events_within_group.many? %>
        <div class="btn-group">
          <% @spread_display.ordered_events_within_group.each do |event| %>
              <%= link_to "#{event.name}",
                          spread_event_path(event, display_style: @spread_display.display_style),
                          class: 'btn btn-sm btn-primary',
                          disabled: event == @spread_display.event %>
          <% end %>
        </div>
    <% end %>
  </div>
  <div class="col-xs-7 page-navigation">
    <div class="btn-group">
      <%= link_to 'Elapsed', spread_event_path(@spread_display.event,
                                                    display_style: 'elapsed',
                                                    sort: @spread_display.sort_string),
                  disabled: @spread_display.display_style == 'elapsed',
                  class: 'btn btn-sm btn-primary' %>
      <%= link_to 'AM / PM', spread_event_path(@spread_display.event,
                                               display_style: 'ampm',
                                               sort: @spread_display.sort_string),
                  disabled: @spread_display.display_style == 'ampm',
                  class: 'btn btn-sm btn-primary' %>
      <%= link_to '24-hour', spread_event_path(@spread_display.event,
                                                    display_style: 'military',
                                                    sort: @spread_display.sort_string),
                  disabled: @spread_display.display_style == 'military',
                  class: 'btn btn-sm btn-primary' %>
      <%= link_to 'Segment', spread_event_path(@spread_display.event,
                                                    display_style: 'segment',
                                                    sort: @spread_display.sort_string),
                  disabled: @spread_display.display_style == 'segment',
                  class: 'btn btn-sm btn-primary' %>
    </div>
  </div>
</div>

<% if @spread_display.show_partner_banners? %>
    <%= render 'partner_banner', partner: @spread_display.partner_with_banner %>
<% end %>

<% cache "#{@spread_display.cache_key}/html", expires_in: @spread_display.cache_expire do %>
    <table class="table table-condensed table-striped">
      <thead>
      <tr>
        <th>O/G<br/><%= link_to 'Place', spread_event_path(@spread_display.event,
                                                           display_style: params[:display_style],
                                                           sort: reversed_sort_param(@spread_display, :overall_rank)) %>
        </th>
        <th><%= link_to 'Bib', spread_event_path(@spread_display.event,
                                                 display_style: params[:display_style],
                                                 sort: reversed_sort_param(@spread_display, :bib_number)) %></th>
        <th><%= link_to 'Name', spread_event_path(@spread_display.event,
                                                  display_style: params[:display_style],
                                                  sort: toggled_sort_param(@spread_display, :last_name, :first_name)) %></th>
        <th>Category</th>
        <th>From</th>
        <% spread_relevant_elements(@spread_display.split_header_data).each do |header| %>
            <th class="text-nowrap text-center">
              <%= clustered_header(header) %>
            </th>
        <% end %>
        <% if @spread_display.show_segment_totals? %>
            <th class="text-center text-nowrap">
              <%= clustered_segment_total_header %>
            </th>
        <% end %>
      </tr>
      </thead>
      <tbody>
      <% @spread_display.effort_times_rows.each do |row| %>
          <tr>
            <td><%= "#{row.overall_rank}/#{row.gender_rank}" %></td>
            <td><%= row.bib_number %></td>
            <td class="text-nowrap"><strong><%= link_to row.full_name, effort_path(row.effort) %></strong></td>
            <td class="text-nowrap"><%= row.bio_historic %></td>
            <td class="text-nowrap"><%= row.flexible_geolocation %></td>
            <% spread_relevant_elements(row.time_clusters).each do |cluster| %>
                <td class="text-nowrap text-center">
                  <% if cluster.drop_display? %>
                      <strong><==DONE</strong>
                  <% else %>
                      <%= time_cluster_display_data(cluster, @spread_display.display_style) %>
                  <% end %>
                </td>
            <% end %>
            <% if @spread_display.show_segment_totals? %>
                <td class="text-center text-nowrap">
                  <%= clustered_segment_total_data(row) %>
                </td>
            <% end %>
          </tr>
      <% end %>
      </tbody>
    </table>
<% end %>
