<% content_for :title do %>
    <% "OpenSplitTime: Full spread - #{@spread_display.name}" %>
<% end %>
<div class="row">
  <h2><%= "#{@spread_display.name} (#{@spread_display.display_style_text})" %></h2>
</div>
<div class="row">
  <strong><%= "Start Time: #{l(@spread_display.start_time, format: :full_with_weekday)} at #{l(@spread_display.start_time, format: :ampm)}" %></strong><br/>
  <strong>Course:</strong>
  <%= link_to @spread_display.course_name, course_path(@spread_display.course) %>
  <% if @spread_display.race %> |
      <strong>Race:</strong>
      <%= link_to @spread_display.race_name, race_path(@spread_display.race) %>
  <% end %>
</div>
<hr>
<div class="row">
  <div class="col-xs-6">
    <%= link_to '<< Back to event', event_path(@spread_display.event), class: 'btn btn-sm btn-default' %>
  </div>
  <div class="col-xs-6">
    <div class="text-right">
      <div class="btn-group">
        <%= link_to 'Elapsed time', spread_event_path(@spread_display.event,
                                                      style: 'elapsed',
                                                      sort_by: params[:sort_by]),
                    disabled: params[:style] == 'elapsed',
                    class: 'btn btn-sm btn-primary' %>
        <%= link_to 'AM / PM', spread_event_path(@spread_display.event,
                                                 style: 'time_of_day',
                                                 sort_by: params[:sort_by]),
                    disabled: params[:style] == 'time_of_day',
                    class: 'btn btn-sm btn-primary' %>
        <%= link_to 'Military', spread_event_path(@spread_display.event,
                                                  style: 'military',
                                                  sort_by: params[:sort_by]),
                    disabled: params[:style] == 'military',
                    class: 'btn btn-sm btn-primary' %>
        <%= link_to 'Segment time', spread_event_path(@spread_display.event,
                                                      style: 'segment',
                                                      sort_by: params[:sort_by]),
                    disabled: params[:style] == 'segment',
                    class: 'btn btn-sm btn-primary' %>
      </div>
    </div>
  </div>
</div>
<hr>
<table class="table table-condensed table-striped">
  <thead>
  <tr>
    <th><%= link_to 'Place', spread_event_path(@spread_display.event,
                                               style: params[:style],
                                               sort_by: 'place') %></th>
    <th><%= link_to 'Bib', spread_event_path(@spread_display.event,
                                             style: params[:style],
                                             sort_by: 'bib') %></th>
    <% if params[:sort_by] == 'last' %>
        <th><%= link_to 'Name', spread_event_path(@spread_display.event,
                                                  style: params[:style],
                                                  sort_by: 'first') %></th>
    <% else %>
        <th><%= link_to 'Name', spread_event_path(@spread_display.event,
                                                  style: params[:style],
                                                  sort_by: 'last') %></th>
    <% end %>
    <th>Category</th>
    <th>From</th>
    <% @spread_display.relevant_splits.each do |split| %>
        <th class="text-nowrap text-center">
          <%= split.base_name %><br>
          <% if @spread_display.display_style == 'segment' %>
              <%= 'Segment / Aid' if split.intermediate? %>
          <% else %>
              <%= split.name_extensions.join(' / ') if split.intermediate? %>
          <% end %>
        </th>
    <% end %>
  </tr>
  </thead>
  <tbody>
  <% @spread_display.effort_times_rows.each do |row| %>
      <tr>
        <td><%= row.place %></td>
        <td><%= row.bib_number %></td>
        <td class="text-nowrap"><strong><%= link_to row.full_name, effort_path(row.effort) %></strong></td>
        <td class="text-nowrap"><%= row.bio_historic %></td>
        <td class="text-nowrap"><%= row.state_and_country %></td>
        <% row.time_clusters.each do |cluster| %>
            <td class="text-nowrap text-center">
              <% case @spread_display.display_style %>
              <% when 'segment' %>
                  <% if cluster.finish? %>
                      <%= time_format_hhmm(cluster.segment_time) %>
                  <% else %>
                      <%= [time_format_hhmm(cluster.segment_time), time_format_minutes(cluster.time_in_aid)].join(' / ') %>
                  <% end %>
              <% when 'time_of_day' %>
                  <%= cluster.days_and_times.map { |time| day_time_format(time) }.join(' / ') %>
              <% when 'military' %>
                  <%= cluster.days_and_times.map { |time| day_time_military_format(time) }.join(' / ') %>
              <% else %>
                  <%= cluster.times_from_start.map { |time| time_format_hhmm(time) }.join(' / ') %>
              <% end %>
            </td>
        <% end %>
      </tr>
  <% end %>
  </tbody>
</table>
